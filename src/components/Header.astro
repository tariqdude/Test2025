---
import { SITE_TITLE } from '../consts';
import { withBasePath } from '../utils/helpers';
import ThemeToggle from './ui/ThemeToggle.astro';

const homeHref = withBasePath('/');

const links = [
  { label: 'About', href: withBasePath('about/') },
  { label: 'Services', href: withBasePath('services/') },
  { label: 'Pricing', href: withBasePath('pricing/') },
  { label: 'Demo Center', href: withBasePath('demo/'), featured: true },
  { label: 'Components', href: withBasePath('components/') },
  { label: 'Visual Showcase', href: withBasePath('visual-showcase/') },
  { label: 'Blog', href: withBasePath('blog/') },
];
---

<header
  class="sticky top-0 z-50 border-t-4 border-t-accent-500 border-b border-b-zinc-800 bg-zinc-950/95 backdrop-blur-md"
>
  <nav
    class="mx-auto flex max-w-[1400px] items-center justify-between px-5 py-0 sm:px-6 lg:px-8 h-16"
    aria-label="Main navigation"
  >
    <a
      class="flex items-center gap-3 text-zinc-100 group h-full py-3"
      href={homeHref}
      aria-label="Elite Project home"
    >
      <span
        class="inline-flex h-8 w-8 items-center justify-center border border-zinc-700 bg-zinc-900 text-[10px] font-bold uppercase tracking-widest text-zinc-100 transition-colors group-hover:border-accent-500 group-hover:text-accent-500"
      >
        EP
      </span>
      <div class="flex flex-col leading-none">
        <span
          class="text-sm font-bold tracking-tight text-zinc-100 font-display uppercase"
        >
          {SITE_TITLE}
        </span>
        <span
          class="text-[0.6rem] font-mono uppercase tracking-widest text-accent-500 mt-0.5"
        >
          SYS.ONLINE
        </span>
      </div>
    </a>

    <div class="hidden md:flex items-center h-full">
      <a
        class="flex items-center h-full px-4 text-zinc-400 transition hover:text-white hover:bg-zinc-900 border-l border-zinc-800/50 font-mono text-xs uppercase tracking-wide"
        href={homeHref}
      >
        [01] Home
      </a>
      {
        links.map((link, index) => (
          <a
            class={
              link.featured
                ? 'flex items-center h-full px-4 relative text-accent-400 transition hover:text-accent-300 hover:bg-zinc-900 border-l border-zinc-800/50 font-mono text-xs uppercase tracking-wide font-bold'
                : 'flex items-center h-full px-4 text-zinc-400 transition hover:text-white hover:bg-zinc-900 border-l border-zinc-800/50 font-mono text-xs uppercase tracking-wide'
            }
            href={link.href}
          >
            [{String(index + 2).padStart(2, '0')}] {link.label}
          </a>
        ))
      }
      <div class="h-full w-px bg-zinc-800/50"></div>
    </div>

    <div class="hidden md:flex items-center gap-4 pl-6">
      <ThemeToggle variant="icon" />
      <div class="h-6 w-px bg-zinc-800"></div>
      <a
        class="btn btn-secondary text-xs uppercase tracking-wider font-mono rounded-sm"
        href={withBasePath('showcase/')}
      >
        Showcase
      </a>
      <a
        class="btn btn-primary text-xs uppercase tracking-wider font-mono rounded-sm"
        href={withBasePath('contact/')}
      >
        Briefing
      </a>
    </div>

    <div class="md:hidden">
      <button
        class="inline-flex h-10 w-10 items-center justify-center border border-zinc-800 text-zinc-400 transition hover:border-zinc-600 hover:text-white bg-zinc-900"
        id="mobile-menu-button"
        type="button"
        aria-controls="mobile-menu"
        aria-expanded="false"
      >
        <span class="sr-only">Toggle navigation</span>
        <svg
          class="h-5 w-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            d="M4 7h16M4 12h16M4 17h16"
            stroke-linecap="square"
            stroke-linejoin="miter"
            stroke-width="1.5"></path>
        </svg>
      </button>
    </div>
  </nav>

  <div class="md:hidden" id="mobile-menu" hidden>
    <div
      class="space-y-2 border-t border-white/10 bg-[rgba(11,19,35,0.92)] px-4 py-5 text-sm"
    >
      <a
        class="block rounded-lg px-3 py-2 font-medium text-slate-200 transition hover:bg-white/5"
        href={homeHref}
      >
        Home
      </a>
      {
        links.map(link => (
          <a
            class="block rounded-lg px-3 py-2 font-medium text-slate-200 transition hover:bg-white/5"
            href={link.href}
          >
            {link.label}
          </a>
        ))
      }
      <a
        class="block rounded-lg px-3 py-2 font-semibold text-slate-100 transition hover:bg-white/5"
        href={withBasePath('showcase/')}
      >
        View showcase
      </a>
      <a
        class="block rounded-lg bg-[rgba(99,102,241,0.15)] px-3 py-2 font-semibold text-white transition hover:bg-[rgba(99,102,241,0.25)]"
        href={withBasePath('contact/')}
      >
        Request a briefing
      </a>
    </div>
  </div>
</header>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggle = document.getElementById('mobile-menu-button');
    const menu = document.getElementById('mobile-menu');

    if (!toggle || !menu) {
      return;
    }

    const closeMenu = () => {
      menu.setAttribute('hidden', '');
      toggle.setAttribute('aria-expanded', 'false');
      // Return focus to toggle button when menu closes
      toggle.focus();
    };

    const openMenu = () => {
      menu.removeAttribute('hidden');
      toggle.setAttribute('aria-expanded', 'true');
      // Focus first link in menu for better keyboard navigation
      const firstLink = menu.querySelector('a');
      if (firstLink) {
        setTimeout(() => firstLink.focus(), 50);
      }
    };

    toggle.addEventListener('click', () => {
      const isHidden = menu.hasAttribute('hidden');
      if (isHidden) {
        openMenu();
      } else {
        closeMenu();
      }
    });

    // Close menu on Escape key
    document.addEventListener('keydown', event => {
      if (event.key === 'Escape' && !menu.hasAttribute('hidden')) {
        closeMenu();
      }
    });

    // Close menu when clicking outside
    document.addEventListener('click', event => {
      const target = event.target;
      if (
        target instanceof Node &&
        !menu.hasAttribute('hidden') &&
        !menu.contains(target) &&
        !toggle.contains(target)
      ) {
        closeMenu();
      }
    });

    // Close menu when navigating to a page
    menu.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        // Small delay to allow navigation to proceed
        setTimeout(closeMenu, 100);
      });
    });
  });
</script>
