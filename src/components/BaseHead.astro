---
// Import the global.css file here so that it is included on
// all pages through the use of the <BaseHead /> component.
import '../styles/global.css';

// Import fonts
import '@fontsource/inter/400.css';
import '@fontsource/inter/500.css';
import '@fontsource/inter/600.css';
import '@fontsource/inter/700.css';
import '@fontsource/space-grotesk/500.css';
import '@fontsource/space-grotesk/600.css';
import '@fontsource/jetbrains-mono/400.css';
import '@fontsource/jetbrains-mono/600.css';

import type { ImageMetadata } from 'astro';
import FallbackImage from '../assets/blog-placeholder-1.jpg';
import { SITE_TITLE } from '../consts';

interface Props {
  title: string;
  description: string;
  image?: ImageMetadata;
  type?: 'website' | 'article';
  author?: string;
  publishDate?: Date;
}

const canonicalURL = new URL(Astro.url.pathname, Astro.site);

const {
  title,
  description,
  image = FallbackImage,
  type = 'website',
  author,
  publishDate,
} = Astro.props;

import { generateMetaTags } from '../utils/seo';
import { ClientRouter } from 'astro:transitions';

const metaTags = generateMetaTags({
  title,
  description,
  image: new URL(image.src, Astro.url).toString(),
  url: canonicalURL,
  type,
  author,
  publishDate,
});
---

<!-- Global Metadata -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="theme-color" content="#09090b" />
<ClientRouter />
<script>
  import '../scripts/animations';
  import '../scripts/magnetic-buttons';
  import '../scripts/spotlight';
</script>
<link
  rel="icon"
  type="image/svg+xml"
  href={`${import.meta.env.BASE_URL}favicon.svg`}
/>

<!-- PWA Manifest -->
<link rel="manifest" href={`${import.meta.env.BASE_URL}manifest.webmanifest`} />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta
  name="apple-mobile-web-app-status-bar-style"
  content="black-translucent"
/>
<meta name="apple-mobile-web-app-title" content={SITE_TITLE} />

<link rel="sitemap" href={`${import.meta.env.BASE_URL}sitemap-index.xml`} />
<link
  rel="alternate"
  type="application/rss+xml"
  title={SITE_TITLE}
  href={new URL('rss.xml', Astro.site)}
/>
<meta name="generator" content={Astro.generator} />

<!-- Theme Initialization Script (Prevents FOUC) -->
<script is:inline>
  (function () {
    try {
      const root = document.documentElement;
      const savedTheme = localStorage.getItem('theme');

      // Default to 'ops-center' if no preference, or map legacy 'dark'/'light'
      let theme = savedTheme;
      if (!theme) {
        theme = 'ops-center'; // Default
      } else if (theme === 'dark') {
        theme = 'ops-center';
      } else if (theme === 'light') {
        theme = 'corporate';
      }

      root.dataset.theme = theme;

      // Handle Tailwind dark mode class
      if (theme === 'corporate') {
        root.classList.remove('dark');
      } else {
        root.classList.add('dark');
      }

      window.__theme = theme;
    } catch (error) {
      console.error('Theme initialization failed:', error);
    }
  })();
</script>

<!-- Canonical URL -->
<link rel="canonical" href={canonicalURL} />

<!-- Generated Meta Tags -->
<title>{title}</title>
{
  metaTags.map(tag => {
    if ('name' in tag) {
      return <meta name={tag.name} content={tag.content} />;
    } else {
      return <meta property={tag.property} content={tag.content} />;
    }
  })
}
