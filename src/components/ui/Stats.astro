---
export interface Props {
  title: string;
  subtitle?: string;
  stats: Array<{
    label: string;
    value: string;
    description?: string;
    icon?: string;
    trend?: {
      direction: 'up' | 'down' | 'neutral';
      value: string;
    };
  }>;
  variant?: 'default' | 'gradient' | 'minimal' | 'glass';
  columns?: 2 | 3 | 4;
  animated?: boolean;
  className?: string;
}

const {
  title,
  subtitle,
  stats,
  variant = 'default',
  columns = 4,
  animated = true,
  className = '',
} = Astro.props;

const variants = {
  default:
    'bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700',
  gradient:
    'bg-gradient-to-br from-primary-50 to-secondary-50 dark:from-primary-900/20 dark:to-secondary-900/20 border border-primary-200 dark:border-primary-700',
  minimal: 'bg-transparent',
  glass:
    'bg-white/10 dark:bg-black/20 backdrop-blur-xl border border-white/20 dark:border-white/10',
};

const columnClasses = {
  2: 'md:grid-cols-2',
  3: 'md:grid-cols-3',
  4: 'md:grid-cols-2 lg:grid-cols-4',
};

const trendColors = {
  up: 'text-green-600 dark:text-green-400',
  down: 'text-red-600 dark:text-red-400',
  neutral: 'text-gray-500 dark:text-gray-400',
};

const trendIcons = {
  up: 'M5 10l7-7m0 0l7 7m-7-7v18',
  down: 'M19 14l-7 7m0 0l-7-7m7 7V3',
  neutral: 'M5 12h14',
};
---

<section
  class={`rounded-xl p-8 ${variants[variant]} ${className}`}
  aria-labelledby="stats-title"
>
  <div class="text-center mb-8">
    <h2
      id="stats-title"
      class="text-3xl font-bold text-gray-900 dark:text-white mb-2"
    >
      {title}
    </h2>
    {
      subtitle && (
        <p class="text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
          {subtitle}
        </p>
      )
    }
  </div>

  <dl
    class={`grid grid-cols-1 ${columnClasses[columns]} gap-6`}
    role="list"
    aria-label="Statistics"
  >
    {
      stats.map((stat, index) => (
        <div
          class={`text-center p-4 rounded-lg transition-all duration-300 hover:scale-105 hover:shadow-lg ${
            animated ? 'opacity-0 animate-fade-in-up' : ''
          }`}
          style={
            animated
              ? `animation-delay: ${index * 100}ms; animation-fill-mode: forwards;`
              : ''
          }
          role="listitem"
        >
          {stat.icon && (
            <div
              class="text-primary-600 dark:text-primary-400 mb-3"
              aria-hidden="true"
            >
              <svg
                class="w-8 h-8 mx-auto"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <use href={`#${stat.icon}`} />
              </svg>
            </div>
          )}
          <dt class="text-sm font-medium text-primary-600 dark:text-primary-400 mb-1 order-2">
            {stat.label}
          </dt>
          <dd class="order-1">
            <span class="text-3xl font-bold text-gray-900 dark:text-white tabular-nums">
              {stat.value}
            </span>
            {stat.trend && (
              <span
                class={`inline-flex items-center ml-2 text-sm ${trendColors[stat.trend.direction]}`}
                aria-label={`Trend ${stat.trend.direction}: ${stat.trend.value}`}
              >
                <svg
                  class="w-4 h-4 mr-0.5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d={trendIcons[stat.trend.direction]}
                  />
                </svg>
                {stat.trend.value}
              </span>
            )}
          </dd>
          {stat.description && (
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2 order-3">
              {stat.description}
            </p>
          )}
        </div>
      ))
    }
  </dl>
</section>

<style>
  @keyframes fade-in-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in-up {
    animation: fade-in-up 0.5s ease-out;
  }

  .tabular-nums {
    font-variant-numeric: tabular-nums;
  }
</style>
