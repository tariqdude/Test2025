---
/**
 * Pricing Card Component
 * Displays pricing tiers with features list and CTA
 * Full accessibility support with proper ARIA attributes
 */

export interface PricingFeature {
  name: string;
  description?: string;
  included: boolean;
}

export interface Props {
  /** Plan title */
  title: string;
  /** Plan description */
  description?: string;
  /** List of features */
  features: PricingFeature[];
  /** Price display (e.g., "$29", "Free") */
  price: string;
  /** Billing period */
  period?: string;
  /** Highlight as popular/recommended */
  popular?: boolean;
  /** Call-to-action button */
  cta: {
    text: string;
    href: string;
  };
  /** Additional CSS classes */
  className?: string;
  /** Badge text (overrides "Most Popular" for popular plans) */
  badge?: string;
  /** Glass morphism effect */
  glass?: boolean;
  /** Gradient accent color */
  accentColor?: 'primary' | 'secondary' | 'accent' | 'gradient';
  /** Annual price for comparison */
  annualPrice?: string;
  /** Savings text (e.g., "Save 20%") */
  savings?: string;
}

const {
  title,
  description,
  features,
  price,
  period = 'month',
  popular = false,
  cta,
  className = '',
  badge,
  glass = false,
  accentColor = 'primary',
  annualPrice,
  savings,
} = Astro.props;

const cardClasses = glass
  ? 'backdrop-blur-xl bg-white/10 dark:bg-black/20'
  : 'bg-white dark:bg-gray-800';

const accentClasses = {
  primary: 'from-primary-500 to-primary-600',
  secondary: 'from-gray-500 to-gray-600',
  accent: 'from-accent-500 to-accent-600',
  gradient: 'from-primary-500 via-accent-500 to-secondary-500',
};

const ctaClasses = popular
  ? `bg-gradient-to-r ${accentClasses[accentColor]} text-white hover:opacity-90 shadow-lg`
  : 'bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600';
---

<article
  class={`relative ${cardClasses} rounded-2xl border ${
    popular
      ? 'border-primary-500 ring-2 ring-primary-500/20 scale-105 shadow-2xl z-10'
      : 'border-gray-200 dark:border-gray-700 shadow-lg hover:shadow-xl'
  } p-8 transition-all duration-300 hover:-translate-y-1 ${className}`}
  aria-labelledby={`pricing-${title.toLowerCase().replace(/\s+/g, '-')}-title`}
>
  {/* Popular/Badge indicator */}
  {
    (popular || badge) && (
      <div class="absolute -top-4 left-1/2 transform -translate-x-1/2">
        <span
          class={`bg-gradient-to-r ${accentClasses[accentColor]} text-white px-4 py-1.5 rounded-full text-sm font-semibold shadow-lg`}
          role="status"
        >
          {badge || 'Most Popular'}
        </span>
      </div>
    )
  }

  <header class="text-center mb-8">
    <h3
      id={`pricing-${title.toLowerCase().replace(/\s+/g, '-')}-title`}
      class="text-2xl font-bold text-gray-900 dark:text-white mb-2"
    >
      {title}
    </h3>
    {
      description && (
        <p class="text-gray-600 dark:text-gray-300 mb-6 text-sm">
          {description}
        </p>
      )
    }

    <div class="mb-2">
      <span
        class="text-5xl font-extrabold text-gray-900 dark:text-white tabular-nums"
        aria-label={`${price} per ${period}`}
      >
        {price}
      </span>
      <span class="text-gray-500 dark:text-gray-400 text-lg">
        /{period}
      </span>
    </div>

    {/* Annual price comparison */}
    {
      annualPrice && (
        <div class="flex items-center justify-center gap-2 text-sm">
          <span class="text-gray-500 dark:text-gray-400">
            or {annualPrice}/year
          </span>
          {savings && (
            <span class="bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 px-2 py-0.5 rounded-full text-xs font-medium">
              {savings}
            </span>
          )}
        </div>
      )
    }

    <a
      href={cta.href}
      class={`mt-6 inline-flex items-center justify-center w-full px-6 py-3.5 rounded-xl font-semibold transition-all duration-300 ${ctaClasses} focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800`}
      aria-describedby={`pricing-${title.toLowerCase().replace(/\s+/g, '-')}-features`}
    >
      {cta.text}
      <svg
        class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
      </svg>
    </a>
  </header>

  <ul
    id={`pricing-${title.toLowerCase().replace(/\s+/g, '-')}-features`}
    class="space-y-4"
    aria-label={`${title} plan features`}
  >
    {
      features.map(feature => (
        <li class="flex items-start group">
          <div
            class={`flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center mt-0.5 mr-3 transition-colors ${
              feature.included
                ? 'bg-green-100 dark:bg-green-900/30 group-hover:bg-green-200 dark:group-hover:bg-green-900/50'
                : 'bg-gray-100 dark:bg-gray-700'
            }`}
            aria-hidden="true"
          >
            <svg
              class={`w-3 h-3 ${
                feature.included
                  ? 'text-green-600 dark:text-green-400'
                  : 'text-gray-400 dark:text-gray-500'
              }`}
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              {feature.included ? (
                <path
                  fill-rule="evenodd"
                  d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                  clip-rule="evenodd"
                />
              ) : (
                <path
                  fill-rule="evenodd"
                  d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                  clip-rule="evenodd"
                />
              )}
            </svg>
          </div>
          <div class="flex-1">
            <span
              class={`text-sm ${
                feature.included
                  ? 'text-gray-900 dark:text-white'
                  : 'text-gray-500 dark:text-gray-400 line-through'
              }`}
            >
              {feature.name}
            </span>
            {feature.description && feature.included && (
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">
                {feature.description}
              </p>
            )}
          </div>
          {!feature.included && <span class="sr-only">(not included)</span>}
        </li>
      ))
    }
  </ul>
</article>
